<!DOCTYPE html>
<html>
  <head>
    <script src="jspsych.js"></script>
    <script src="/plugins/jspsych-canvas-keyboard-response.js"></script>
    <script src="/plugins/jspsych-html-keyboard-response.js"></script>
    <link rel="stylesheet" href="/css/jspsych.css" />
  </head>
  <body></body>
  <script>
    const squareDimension = 50;
    // Square translation, because I receive the center position of the square but the drawing in canvas use the upper left point.
    translationFromCenter = squareDimension / 2;

    //Scaled for 500x500 pixes canvas
    canvasScale = 500;

    // // to use the canvas stimulus function with timeline variables,
    // // the jsPsych.timelineVariable() function can be used inside your stimulus function

    var trial_procedure = {
      timeline: [
        // {
        //   type: "html-keyboard-response",
        //   stimulus: '<div style="font-size:60px;">+</div>',
        //   choices: jsPsych.NO_KEYS,
        //   trial_duration: 300,
        // },
        {
          type: "canvas-keyboard-response",
          stimulus: function (c) {
            var ctx = c.getContext("2d");

            // set the canvas origin (0,0) to center canvas
            // All coordinates to the left of center canvas are negative
            // All coordinates below center canvas are negative
            ctx.translate(c.width / 2, c.height / 2);

            // draw a dot at the new origin
            // only for debug purposes
            ctx.beginPath();
            ctx.arc(0, 0, 5, 0, Math.PI * 2);
            ctx.closePath();
            ctx.fill();
            ctx.textAlign = "center";
            ctx.fillText("[ 0, 0 ]", 0, -10);

            ctx.beginPath();
            ctx.fillStyle = jsPsych.timelineVariable("color");
            ctx.fillRect(
              jsPsych.timelineVariable("upper_left_x"),
              jsPsych.timelineVariable("upper_left_y"),
              jsPsych.timelineVariable("width"),
              jsPsych.timelineVariable("height")
            );
            ctx.fillStyle = jsPsych.timelineVariable("color2");
            ctx.fillRect(
              jsPsych.timelineVariable("upper_left_x2"),
              jsPsych.timelineVariable("upper_left_y2"),
              jsPsych.timelineVariable("width2"),
              jsPsych.timelineVariable("height2")
            );
            ctx.fillStyle = jsPsych.timelineVariable("color3");
            ctx.fillRect(
              jsPsych.timelineVariable("upper_left_x3"),
              jsPsych.timelineVariable("upper_left_y3"),
              jsPsych.timelineVariable("width3"),
              jsPsych.timelineVariable("height3")
            );
            ctx.fillStyle = jsPsych.timelineVariable("color4");
            ctx.fillRect(
              jsPsych.timelineVariable("upper_left_x4"),
              jsPsych.timelineVariable("upper_left_y4"),
              jsPsych.timelineVariable("width4"),
              jsPsych.timelineVariable("height4")
            );
            ctx.fillStyle = jsPsych.timelineVariable("color5");
            ctx.fillRect(
              jsPsych.timelineVariable("upper_left_x5"),
              jsPsych.timelineVariable("upper_left_y5"),
              jsPsych.timelineVariable("width5"),
              jsPsych.timelineVariable("height5")
            );
            ctx.stroke();
          },
          choices: ["a", "l"],
          trial_duration: jsPsych.timelineVariable("trial_duration"),
          prompt: jsPsych.timelineVariable("prompt"),

          data: {
            upper_left_x: jsPsych.timelineVariable("upper_left_x"),
            upper_left_y: jsPsych.timelineVariable("upper_left_y"),
            color: jsPsych.timelineVariable("color"),

            upper_left_x2: jsPsych.timelineVariable("upper_left_x2"),
            upper_left_y2: jsPsych.timelineVariable("upper_left_y2"),
            color2: jsPsych.timelineVariable("color2"),

            upper_left_x3: jsPsych.timelineVariable("upper_left_x3"),
            upper_left_y3: jsPsych.timelineVariable("upper_left_y3"),
            color3: jsPsych.timelineVariable("color3"),

            upper_left_x4: jsPsych.timelineVariable("upper_left_x4"),
            upper_left_y4: jsPsych.timelineVariable("upper_left_y4"),
            color4: jsPsych.timelineVariable("color4"),

            upper_left_x5: jsPsych.timelineVariable("upper_left_x5"),
            upper_left_y5: jsPsych.timelineVariable("upper_left_y5"),
            color5: jsPsych.timelineVariable("color5"),

            upper_left_x6: jsPsych.timelineVariable("upper_left_x6"),
            upper_left_y6: jsPsych.timelineVariable("upper_left_y6"),
            color6: jsPsych.timelineVariable("color6"),

            upper_left_x7: jsPsych.timelineVariable("upper_left_x7"),
            upper_left_y7: jsPsych.timelineVariable("upper_left_y7"),
            color7: jsPsych.timelineVariable("color7"),

            upper_left_x8: jsPsych.timelineVariable("upper_left_x8"),
            upper_left_y8: jsPsych.timelineVariable("upper_left_y8"),
            color8: jsPsych.timelineVariable("color8"),
          },
        },
      ],

      timeline_variables: [
        {
          algo: 1,
          trial_duration: 5000,
          upper_left_x: -0.5 * canvasScale - translationFromCenter,
          upper_left_y: -0.5 * canvasScale - translationFromCenter,
          height: squareDimension,
          width: squareDimension,
          color: "orange",

          upper_left_x2: 0.5 * canvasScale - translationFromCenter,
          upper_left_y2: 0.5 * canvasScale - translationFromCenter,
          height2: squareDimension,
          width2: squareDimension,
          color2: "blue",

          upper_left_x3: -0.14 * canvasScale - translationFromCenter,
          upper_left_y3: -0.27 * canvasScale - translationFromCenter,
          height3: squareDimension,
          width3: squareDimension,
          color3: "white",

          upper_left_x4: -0.41 * canvasScale - translationFromCenter,
          upper_left_y4: 0.14 * canvasScale - translationFromCenter,
          height4: squareDimension,
          width4: squareDimension,
          color4: "red",

          // upper_left_x5: 0.14 * canvasScale - translationFromCenter,
          // upper_left_y5: 0.41 * canvasScale - translationFromCenter,
          // height5: squareDimension,
          // width5: squareDimension,
          // color5: "black",

          // upper_left_x6: 0.14 * canvasScale - translationFromCenter,
          // upper_left_y6: 0.41 * canvasScale - translationFromCenter,
          // height6: squareDimension,
          // width6: squareDimension,
          // color6: "black",

          // upper_left_x7: 0.14 * canvasScale - translationFromCenter,
          // upper_left_y7: 0.41 * canvasScale - translationFromCenter,
          // height7: squareDimension,
          // width7: squareDimension,
          // color7: "magenta",

          // upper_left_x8: 0.14 * canvasScale - translationFromCenter,
          // upper_left_y8: 0.41 * canvasScale - translationFromCenter,
          // height8: squareDimension,
          // width8: squareDimension,
          // color8: "yellow",
        },
        {
          //   trial_duration: 2000,
          upper_left_x: 150,
          upper_left_y: 100,
          height: 50,
          width: 50,
          color: "red",
          prompt: `<h1 style='position: absolute'> Â¿Igual (A) o diferente (L)? </h1>`,
        },
      ],
    };

    jsPsych.init({
      timeline: [trial_procedure],
      on_finish: function () {
        jsPsych.data.displayData();
      },
    });
  </script>
</html>
